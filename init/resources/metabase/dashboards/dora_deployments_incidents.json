{
  "name": "DORA - Deployments and Incidents",
  "cards": [
    {
      "name": "LeadTime",
      "description": null,
      "display": "table",
      "table_id": null,
      "dataset_query": {
        "type": "native",
        "native": {
          "query": "with pr_review as (\n    select \n        \"pr\".\"id\" as pr_id,\n        \"pr\".\"mergeCommit\",\n        \"pr\".\"createdAt\" as pr_created_at,\n        case\n            when \"review\".\"state\" is null then extract(epoch from (\"pr\".\"mergedAt\" - \"pr\".\"createdAt\")) * 1000\n            else extract(epoch from (\"pr\".\"mergedAt\" - \"review\".\"submittedAt\")) * 1000\n        end as pr_merge_time,\n        case\n            when \"review\".\"state\" is null then 0\n            else extract(epoch from (\"review\".\"submittedAt\" - \"pr\".\"createdAt\")) * 1000\n        end as pr_review_time, \n        row_number() over (\n            partition by \"pr\".\"id\"\n            order by \"review\".\"submittedAt\" desc\n        ) as review_rank\n    from \"vcs_PullRequest\" as pr left outer join \"vcs_PullRequestReview\" as review \n    on \"pr\".\"id\" = \"review\".\"pullRequest\" and\n        (\"pr\".\"mergedAt\" > \"review\".\"submittedAt\" or \"review\".\"state\" is null)  \n    where \"pr\".\"mergedAt\" is not null\n),\ncommit_pr as (\n    select * from \"vcs_Commit\" as commit inner join pr_review on \"commit\".\"id\" = \"pr_review\".\"mergeCommit\" where review_rank = 1\n),\nartifact as (\n    select commit_pr.*, artifact from commit_pr inner join \"cicd_ArtifactCommitAssociation\" as artifact_commit on commit_pr.id = artifact_commit.commit\n),\ndeployment as (\n    select\n        artifact.*, \n        \"cicd_Deployment\".id as deployment,\n        \"cicd_Deployment\".\"endedAt\" as deployment_ended_at,\n        \"cicd_Deployment\".\"envCategory\" as env_category,\n        \"cicd_Deployment\".\"statusCategory\" as status_category,\n        \"cicd_Deployment\".\"application\" as application,\n        row_number() over (\n            partition by deployment\n            order by artifact.\"createdAt\" desc\n        ) as commit_rank  \n    from artifact inner join \"cicd_ArtifactDeployment\" as ad on artifact.artifact = ad.artifact \n    inner join \"cicd_Deployment\" on ad.deployment = \"cicd_Deployment\".\"id\"\n),\nordered_deployment as (\n    select \n        *, \n        row_number() over (\n            partition by env_category, application \n            order by deployment_ended_at\n        ) as deploy_rank \n    from deployment\n    where commit_rank = 1\n),\ndeploy_first_last_commit as (\n    select\n        deploy.*,\n        prev_deploy.id as prev_deploy_commit,\n        prev_deploy.\"createdAt\" as prev_commit_created_at\n    from ordered_deployment as deploy, ordered_deployment as prev_deploy\n    where \n        deploy.deploy_rank = prev_deploy.deploy_rank + 1 and \n        deploy.env_category = prev_deploy.env_category and\n        deploy.application = prev_deploy.application\n    ),\ndeploy_changeset as (\n    select \n        deploy.deployment,\n        deploy.deployment_ended_at,\n        deploy.env_category,\n        deploy.application,\n        commit.* \n    from deploy_first_last_commit as deploy, commit_pr as commit\n    where \n        commit.\"createdAt\" > deploy.prev_commit_created_at and\n        commit.\"createdAt\" <= deploy.\"createdAt\" and\n        commit.repository = deploy.repository\n    union\n    -- the very first time deployments are instrumented, there is no previous\n    -- deployment to compare to for the changeset calculation. so just include\n    -- the commit that's directly attached to the deployment as the changeset.\n    select\n        deploy.deployment,\n        deploy.deployment_ended_at,\n        deploy.env_category,\n        deploy.application as application,\n        commit.*\n    from ordered_deployment as deploy, commit_pr as commit\n    where\n        commit.id = deploy.id\n),\nstart_times as (\n    select\n        *,\n        case\n            when env_category = 'Prod' then deployment_ended_at\n            else null\n        end as prod_deployed_at,\n        case\n            when env_category = 'Staging' then deployment_ended_at\n            else null\n        end as staging_deployed_at,\n        case\n            when env_category = 'QA' then deployment_ended_at\n            else null\n        end as qa_deployed_at,\n        case\n            when env_category = 'Dev' then deployment_ended_at\n            else null\n        end as dev_deployed_at\n    from deploy_changeset   \n),\ngrouped_start_times as (\n    select \n        id as commit_id, \n        repository,\n        pr_created_at,\n        pr_merge_time,\n        pr_review_time,\n        min(prod_deployed_at) as prod_deployed_at,\n        min(staging_deployed_at) as staging_deployed_at,\n        min(qa_deployed_at) as qa_deployed_at,\n        min(dev_deployed_at) as dev_deployed_at,\n        application\n    from start_times\n    group by id, repository, pr_created_at, pr_merge_time, pr_review_time, application\n),\nbreakdown as (\n    select\n        commit_id,\n        repository,\n        pr_created_at,\n        prod_deployed_at,\n        extract(epoch from (prod_deployed_at - pr_created_at)) * 1000 as lead_time,\n        pr_merge_time,\n        pr_review_time,\n        case\n            when dev_deployed_at is null then 0\n            when qa_deployed_at is not null then extract(epoch from (qa_deployed_at - dev_deployed_at)) * 1000\n            when staging_deployed_at is not null then extract(epoch from (staging_deployed_at - dev_deployed_at)) * 1000\n            when prod_deployed_at is not null then extract(epoch from (prod_deployed_at - dev_deployed_at)) * 1000\n        end as time_in_dev,\n        case\n            when qa_deployed_at is null then 0\n            when staging_deployed_at is not null then extract(epoch from (staging_deployed_at - qa_deployed_at)) * 1000\n            when prod_deployed_at is not null then extract(epoch from (prod_deployed_at - qa_deployed_at)) * 1000\n        end as time_in_qa,\n        case\n            when staging_deployed_at is null then 0\n            when prod_deployed_at is not null then extract(epoch from (prod_deployed_at - staging_deployed_at)) * 1000\n        end as time_in_staging,\n        application\n    from grouped_start_times\n    where prod_deployed_at is not null\n)\nselect \n  *,\n  lead_time - (pr_review_time + pr_merge_time + time_in_dev + time_in_qa + time_in_staging) as unaccounted_time\nfrom breakdown\n\n",
          "template-tags": {}
        }
      },
      "visualization_settings": {
        "table.pivot_column": "message",
        "table.cell_column": "pr_merge_time"
      }
    },
    {
      "name": "IncidentsAndDeployments",
      "description": null,
      "display": "table",
      "table_id": null,
      "dataset_query": {
        "native": {
          "template-tags": {},
          "query": "SELECT 'Incident' as type, \"ims_Incident\".\"createdAt\" as date, \"compute_Application\".\"name\" as application FROM \"ims_Incident\" \n  LEFT JOIN \"ims_IncidentApplicationImpact\" ON \"ims_Incident\".\"id\" = \"ims_IncidentApplicationImpact\".\"incident\"\n  LEFT JOIN \"compute_Application\" ON \"ims_IncidentApplicationImpact\".\"application\" = \"compute_Application\".\"id\"\nUNION \nSELECT 'Deployment' as type, \"cicd_Deployment\".\"endedAt\" as date, \"compute_Application\".\"name\" as application FROM \"cicd_Deployment\"\n  LEFT JOIN \"compute_Application\" ON \"cicd_Deployment\".\"application\" = \"compute_Application\".\"id\""
        },
        "type": "native"
      },
      "visualization_settings": {
        "gauge.segments": [
          {
            "min": 0,
            "max": 15,
            "color": "#84BB4C",
            "label": "Elite"
          },
          {
            "min": 15,
            "max": 30,
            "color": "#F9D45C",
            "label": "High"
          },
          {
            "min": 30,
            "max": 60,
            "color": "#F2A86F",
            "label": "Medium"
          },
          {
            "min": 60,
            "max": 100,
            "color": "#ED6E6E",
            "label": "Low"
          }
        ],
        "table.pivot_column": "type",
        "table.cell_column": "date",
        "column_settings": {
          "[\"name\",\"test\"]": {
            "suffix": " %"
          }
        }
      }
    },
    {
      "name": "Average Lead Time",
      "description": null,
      "display": "gauge",
      "table_id": null,
      "dataset_query": {
        "type": "query",
        "query": {
          "source-table": {{ card "LeadTime" }},
          "aggregation": [
            [
              "avg",
              [
                "field",
                "lead_time",
                {
                  "base-type": "type/Float"
                }
              ]
            ]
          ]
        }
      },
      "visualization_settings": {
        "gauge.segments": [
          {
            "min": 0,
            "max": 86400000,
            "color": "#84BB4C",
            "label": "Elite"
          },
          {
            "min": 86400000,
            "max": 604800000,
            "color": "#F9CF48",
            "label": "High"
          },
          {
            "min": 604800000,
            "max": 2608520630,
            "color": "#F2A86F",
            "label": "Medium"
          },
          {
            "min": 2608520630,
            "max": 5217041260,
            "color": "#ED6E6E",
            "label": "Low"
          }
        ],
        "column_settings": {
          "[\"name\",\"avg\"]": {
            "scale": 1.15e-8,
            "suffix": " days",
            "decimals": 1
          }
        }
      }
    },
    {
      "name": "Lead Time by Application over Time",
      "description": null,
      "display": "line",
      "table_id": null,
      "dataset_query": {
        "query": {
          "source-table": {{ card "LeadTime" }},
          "aggregation": [
            [
              "avg",
              [
                "field",
                "lead_time",
                {
                  "base-type": "type/Float"
                }
              ]
            ]
          ],
          "breakout": [
            [
              "field",
              "prod_deployed_at",
              {
                "temporal-unit": "week",
                "base-type": "type/DateTimeWithLocalTZ"
              }
            ],
            [
              "field",
              "application",
              {
                "base-type": "type/Text"
              }
            ]
          ]
        },
        "type": "query"
      },
      "visualization_settings": {
        "graph.x_axis.title_text": "Week of",
        "graph.y_axis.title_text": "Average of lead time",
        "graph.dimensions": [
          "prod_deployed_at",
          "application"
        ],
        "column_settings": {
          "[\"name\",\"avg\"]": {
            "scale": 1.157e-8,
            "suffix": " days",
            "decimals": 1
          }
        },
        "graph.metrics": [
          "avg"
        ]
      }
    },
    {
      "name": "Lead Time Breakdown by Application",
      "description": null,
      "display": "bar",
      "table_id": null,
      "dataset_query": {
        "type": "query",
        "query": {
          "source-table": {{ card "LeadTime" }},
          "aggregation": [
            [
              "avg",
              [
                "field",
                "pr_review_time",
                {
                  "base-type": "type/Float"
                }
              ]
            ],
            [
              "avg",
              [
                "field",
                "pr_merge_time",
                {
                  "base-type": "type/Float"
                }
              ]
            ],
            [
              "avg",
              [
                "field",
                "time_in_dev",
                {
                  "base-type": "type/Float"
                }
              ]
            ],
            [
              "avg",
              [
                "field",
                "time_in_qa",
                {
                  "base-type": "type/Float"
                }
              ]
            ],
            [
              "avg",
              [
                "field",
                "time_in_staging",
                {
                  "base-type": "type/Float"
                }
              ]
            ],
            [
              "avg",
              [
                "field",
                "unaccounted_time",
                {
                  "base-type": "type/Float"
                }
              ]
            ]
          ],
          "breakout": [
            [
              "field",
              "application",
              {
                "base-type": "type/Text"
              }
            ]
          ]
        }
      },
      "visualization_settings": {
        "stackable.stack_type": "stacked",
        "series_settings": {
          "avg": {
            "title": "pr review time"
          },
          "avg_2": {
            "title": "pr merge time"
          },
          "avg_3": {
            "title": "time in dev"
          },
          "avg_4": {
            "title": "time in qa"
          },
          "avg_5": {
            "title": "time in staging"
          },
          "avg_6": {
            "title": "unaccounted time"
          }
        },
        "graph.dimensions": [
          "application"
        ],
        "graph.x_axis.title_text": "Application",
        "graph.y_axis.title_text": "Lead Time",
        "column_settings": {
          "[\"name\",\"avg\"]": {
            "scale": 1.157e-8,
            "suffix": " days",
            "decimals": 1
          },
          "[\"name\",\"avg_2\"]": {
            "scale": 1.157e-8,
            "decimals": 1,
            "suffix": " days"
          },
          "[\"name\",\"avg_3\"]": {
            "scale": 1.157e-8,
            "decimals": 1,
            "suffix": " days"
          },
          "[\"name\",\"avg_4\"]": {
            "decimals": 1,
            "scale": 1.157e-8,
            "suffix": " days"
          },
          "[\"name\",\"avg_5\"]": {
            "decimals": 1,
            "scale": 1.157e-8,
            "suffix": " days"
          },
          "[\"name\",\"avg_6\"]": {
            "decimals": 1,
            "scale": 1.157e-8,
            "suffix": " days"
          }
        },
        "graph.metrics": [
          "avg",
          "avg_2",
          "avg_3",
          "avg_4",
          "avg_5",
          "avg_6"
        ]
      }
    },
    {
      "name": "Weekly Production Deployments by Application over Time",
      "description": null,
      "display": "line",
      "table_id": {{ table "cicd_Deployment" }},
      "dataset_query": {
        "type": "query",
        "query": {
          "source-table": {{ table "cicd_Deployment" }},
          "filter": [
            "and",
            [
              "=",
              [
                "field",
                {{ field "cicd_Deployment.statusCategory" }},
                null
              ],
              "Success"
            ],
            [
              "=",
              [
                "field",
                {{ field "cicd_Deployment.envCategory" }},
                null
              ],
              "Prod"
            ]
          ],
          "aggregation": [
            [
              "distinct",
              [
                "field",
                {{ field "cicd_Deployment.id" }},
                null
              ]
            ]
          ],
          "breakout": [
            [
              "field",
              {{ field "cicd_Deployment.endedAt" }},
              {
                "temporal-unit": "week"
              }
            ],
            [
              "field",
              {{ field "compute_Application.name" }},
              {
                "source-field": {{ field "cicd_Deployment.application" }}
              }
            ]
          ]
        }
      },
      "visualization_settings": {
        "graph.x_axis.title_text": "Week Of",
        "graph.y_axis.title_text": "Number of production deployments",
        "graph.dimensions": [
          "endedAt",
          "name"
        ],
        "graph.metrics": [
          "count"
        ]
      }
    },
    {
      "name": "Number of Deployments by Application by Environment",
      "description": null,
      "display": "bar",
      "table_id": {{ table "cicd_Deployment" }},
      "dataset_query": {
        "query": {
          "source-table": {{ table "cicd_Deployment" }},
          "aggregation": [
            [
              "distinct",
              [
                "field",
                {{ field "cicd_Deployment.id" }},
                null
              ]
            ]
          ],
          "breakout": [
            [
              "field",
              {{ field "cicd_Deployment.envCategory" }},
              null
            ],
            [
              "field",
              {{ field "compute_Application.name" }},
              {
                "source-field": {{ field "cicd_Deployment.application" }}
              }
            ]
          ],
          "filter": [
            "=",
            [
              "field",
              {{ field "cicd_Deployment.statusCategory" }},
              null
            ],
            "Success"
          ]
        },
        "type": "query"
      },
      "visualization_settings": {
        "graph.x_axis.title_text": "Application",
        "graph.y_axis.title_text": "Number of Deployments",
        "graph.dimensions": [
          "name",
          "envCategory"
        ],
        "graph.metrics": [
          "count"
        ]
      }
    },
    {
      "name": "Mean Time to Resolution (MTTR)",
      "description": null,
      "display": "gauge",
      "table_id": null,
      "dataset_query": {
        "type": "native",
        "native": {
          "query": "select extract(epoch from avg(\"ims_Incident\".\"resolvedAt\" - \"ims_Incident\".\"createdAt\"))*1000 as time_to_resolution\nfrom \"ims_Incident\"\nwhere \"ims_Incident\".\"resolvedAt\" is not null and <<createdAt>>",
          "template-tags": {
            "createdAt": {
              "id": "640ead5c-9060-8a86-9129-46678ed8a514",
              "name": "createdAt",
              "display-name": "Created At",
              "type": "dimension",
              "dimension": [
                "field",
                {{ field "ims_Incident.createdAt" }},
                null
              ],
              "widget-type": "date/relative"
            }
          }
        }
      },
      "visualization_settings": {
        "gauge.segments": [
          {
            "min": 0,
            "max": 3600000,
            "color": "#84BB4C",
            "label": "Elite"
          },
          {
            "min": 3600000,
            "max": 86400000,
            "color": "#F9CF48",
            "label": "High"
          },
          {
            "min": 86400000,
            "max": 432000000,
            "color": "#F2A86F",
            "label": "Medium"
          },
          {
            "min": 432000000,
            "max": 864000000,
            "color": "#ED6E6E",
            "label": "Low"
          }
        ],
        "column_settings": {
          "[\"name\",\"time_to_resolution\"]": {
            "scale": 2.77e-7,
            "suffix": " hours",
            "decimals": 1
          }
        }
      }
    },
    {
      "name": "MTTR by Application over Time",
      "description": null,
      "display": "line",
      "table_id": null,
      "dataset_query": {
        "type": "native",
        "native": {
          "query": "select extract(epoch from avg(\"ims_Incident\".\"resolvedAt\" - \"ims_Incident\".\"createdAt\"))*1000 as time_to_resolution, \"ims_IncidentApplicationImpact\".\"application\", (cast(date_trunc('week', cast((cast(\"ims_Incident\".\"createdAt\" as timestamp) + (interval '1 day')) as timestamp)) as timestamp) + (interval '-1 day')) as \"createdAt\"\nfrom \"ims_Incident\" left join \"ims_IncidentApplicationImpact\" on \"ims_Incident\".\"id\" = \"ims_IncidentApplicationImpact\".\"incident\"\nwhere \"ims_Incident\".\"resolvedAt\" is not null and <<createdAt>>\ngroup by (cast(date_trunc('week', cast((cast(\"ims_Incident\".\"createdAt\" as timestamp) + (interval '1 day')) as timestamp)) as timestamp) + (interval '-1 day')), \"ims_IncidentApplicationImpact\".\"application\"\norder by (cast(date_trunc('week', cast((cast(\"ims_Incident\".\"createdAt\" as timestamp) + (interval '1 day')) as timestamp)) as timestamp) + (interval '-1 day')) asc, \"ims_IncidentApplicationImpact\".\"application\" asc\n",
          "template-tags": {
            "createdAt": {
              "id": "640ead5c-9060-8a86-9129-46678ed8a514",
              "name": "createdAt",
              "display-name": "Created At",
              "type": "dimension",
              "dimension": [
                "field",
                {{ field "ims_Incident.createdAt" }},
                null
              ],
              "widget-type": "date/relative"
            }
          }
        }
      },
      "visualization_settings": {
        "gauge.segments": [
          {
            "min": 0,
            "max": 3600000,
            "color": "#84BB4C",
            "label": "Elite"
          },
          {
            "min": 3600000,
            "max": 86400000,
            "color": "#F9CF48",
            "label": "High"
          },
          {
            "min": 86400000,
            "max": 432000000,
            "color": "#F2A86F",
            "label": "Medium"
          },
          {
            "min": 432000000,
            "max": 864000000,
            "color": "#ED6E6E",
            "label": "Low"
          }
        ],
        "graph.x_axis.title_text": "Week Of",
        "graph.y_axis.title_text": "Mean Time to Resolution",
        "graph.dimensions": [
          "createdAt",
          "application"
        ],
        "column_settings": {
          "[\"name\",\"time_to_resolution\"]": {
            "scale": 2.77e-7,
            "suffix": " hours",
            "decimals": 1
          }
        },
        "graph.metrics": [
          "time_to_resolution"
        ]
      }
    },
    {
      "name": "MTTR by Application by Severity",
      "description": null,
      "display": "bar",
      "table_id": null,
      "dataset_query": {
        "type": "native",
        "native": {
          "query": "select extract(epoch from avg(\"ims_Incident\".\"resolvedAt\" - \"ims_Incident\".\"createdAt\"))*1000 as time_to_resolution, \"ims_IncidentApplicationImpact\".\"application\", \"ims_Incident\".\"severityCategory\"\nfrom \"ims_Incident\" left join \"ims_IncidentApplicationImpact\" on \"ims_Incident\".\"id\" = \"ims_IncidentApplicationImpact\".\"incident\"\nwhere \"ims_Incident\".\"resolvedAt\" is not null and <<createdAt>>\ngroup by \"ims_Incident\".\"severityCategory\", \"ims_IncidentApplicationImpact\".\"application\"\norder by  \"ims_Incident\".\"severityCategory\" asc, \"ims_IncidentApplicationImpact\".\"application\" asc\n",
          "template-tags": {
            "createdAt": {
              "id": "640ead5c-9060-8a86-9129-46678ed8a514",
              "name": "createdAt",
              "display-name": "Created At",
              "type": "dimension",
              "dimension": [
                "field",
                {{ field "ims_Incident.createdAt" }},
                null
              ],
              "widget-type": "date/relative"
            }
          }
        }
      },
      "visualization_settings": {
        "gauge.segments": [
          {
            "min": 0,
            "max": 3600000,
            "color": "#84BB4C",
            "label": "Elite"
          },
          {
            "min": 3600000,
            "max": 86400000,
            "color": "#F9CF48",
            "label": "High"
          },
          {
            "min": 86400000,
            "max": 432000000,
            "color": "#F2A86F",
            "label": "Medium"
          },
          {
            "min": 432000000,
            "max": 864000000,
            "color": "#ED6E6E",
            "label": "Low"
          }
        ],
        "graph.x_axis.title_text": "Application",
        "graph.y_axis.title_text": "MTTR",
        "graph.dimensions": [
          "application",
          "severityCategory"
        ],
        "column_settings": {
          "[\"name\",\"time_to_resolution\"]": {
            "scale": 2.77e-7,
            "suffix": " hours",
            "decimals": 1
          }
        },
        "graph.metrics": [
          "time_to_resolution"
        ]
      }
    },
    {
      "name": "Change Failure Rate (CFR)",
      "description": null,
      "display": "gauge",
      "table_id": null,
      "dataset_query": {
        "type": "query",
        "query": {
          "source-table": {{ card "IncidentsAndDeployments" }},
          "expressions": {
            "isIncident": [
              "case",
              [
                [
                  [
                    "=",
                    [
                      "field",
                      "type",
                      {
                        "base-type": "type/Text"
                      }
                    ],
                    "Incident"
                  ],
                  1
                ]
              ],
              {
                "default": 0
              }
            ],
            "isDeployment": [
              "case",
              [
                [
                  [
                    "=",
                    [
                      "field",
                      "type",
                      {
                        "base-type": "type/Text"
                      }
                    ],
                    "Deployment"
                  ],
                  1
                ]
              ],
              {
                "default": 0
              }
            ]
          },
          "aggregation": [
            [
              "aggregation-options",
              [
                "/",
                [
                  "sum",
                  [
                    "expression",
                    "isIncident"
                  ]
                ],
                [
                  "sum",
                  [
                    "expression",
                    "isDeployment"
                  ]
                ]
              ],
              {
                "name": "CFR",
                "display-name": "CFR"
              }
            ]
          ]
        }
      },
      "visualization_settings": {
        "gauge.segments": [
          {
            "min": 0,
            "max": 0.15,
            "color": "#84BB4C",
            "label": "Elite"
          },
          {
            "min": 0.15,
            "max": 0.3,
            "color": "#F9CF48",
            "label": "High"
          },
          {
            "min": 0.3,
            "max": 0.6,
            "color": "#F2A86F",
            "label": "Medium"
          },
          {
            "min": 0.6,
            "max": 1,
            "color": "#ED6E6E",
            "label": "Low"
          }
        ],
        "column_settings": {
          "[\"name\",\"CFR\"]": {
            "scale": 100,
            "suffix": " %"
          }
        }
      }
    },
    {
      "name": "CFR by Application over Time",
      "description": null,
      "display": "line",
      "table_id": null,
      "dataset_query": {
        "type": "query",
        "query": {
          "source-table": {{ card "IncidentsAndDeployments" }},
          "breakout": [
            [
              "field",
              "date",
              {
                "temporal-unit": "week",
                "base-type": "type/DateTimeWithLocalTZ"
              }
            ],
            [
              "field",
              "application",
              {
                "base-type": "type/Text"
              }
            ]
          ],
          "expressions": {
            "isIncident": [
              "case",
              [
                [
                  [
                    "=",
                    [
                      "field",
                      "type",
                      {
                        "base-type": "type/Text"
                      }
                    ],
                    "Incident"
                  ],
                  1
                ]
              ],
              {
                "default": 0
              }
            ],
            "isDeployment": [
              "case",
              [
                [
                  [
                    "=",
                    [
                      "field",
                      "type",
                      {
                        "base-type": "type/Text"
                      }
                    ],
                    "Deployment"
                  ],
                  1
                ]
              ],
              {
                "default": 0
              }
            ]
          },
          "aggregation": [
            [
              "aggregation-options",
              [
                "/",
                [
                  "*",
                  [
                    "sum",
                    [
                      "expression",
                      "isIncident"
                    ]
                  ],
                  100
                ],
                [
                  "sum",
                  [
                    "expression",
                    "isDeployment"
                  ]
                ]
              ],
              {
                "name": "CFR",
                "display-name": "CFR"
              }
            ]
          ]
        }
      },
      "visualization_settings": {
        "graph.dimensions": [
          "date",
          "application"
        ],
        "graph.x_axis.title_text": "Week Of",
        "column_settings": {
          "[\"name\",\"CFR\"]": {
            "suffix": " %"
          }
        },
        "graph.metrics": [
          "CFR"
        ]
      }
    },
    {
      "name": "Incidents by Application by Severity",
      "description": null,
      "display": "bar",
      "table_id": {{ table "ims_Incident" }},
      "dataset_query": {
        "query": {
          "source-table": {{ table "ims_Incident" }},
          "joins": [
            {
              "fields": "all",
              "source-table": {{ table "ims_IncidentApplicationImpact" }},
              "condition": [
                "=",
                [
                  "field",
                  {{ field "ims_Incident.id" }},
                  null
                ],
                [
                  "field",
                  {{ field "ims_IncidentApplicationImpact.incident" }},
                  {
                    "join-alias": "Ims IncidentApplicationImpact"
                  }
                ]
              ],
              "alias": "Ims IncidentApplicationImpact"
            },
            {
              "fields": "all",
              "source-table": {{ table "compute_Application" }},
              "condition": [
                "=",
                [
                  "field",
                  {{ field "ims_IncidentApplicationImpact.application" }},
                  {
                    "join-alias": "Ims IncidentApplicationImpact"
                  }
                ],
                [
                  "field",
                  {{ field "compute_Application.id" }},
                  {
                    "join-alias": "Compute Application - Application"
                  }
                ]
              ],
              "alias": "Compute Application - Application"
            }
          ],
          "breakout": [
            [
              "field",
              {{ field "ims_Incident.severityCategory" }},
              null
            ],
            [
              "field",
              {{ field "compute_Application.name" }},
              {
                "join-alias": "Compute Application - Application"
              }
            ]
          ],
          "aggregation": [
            [
              "count"
            ]
          ],
          "order-by": [
            [
              "asc",
              [
                "field",
                {{ field "ims_Incident.severityCategory" }},
                null
              ]
            ],
            [
              "asc",
              [
                "field",
                {{ field "compute_Application.name" }},
                {
                  "join-alias": "Compute Application - Application"
                }
              ]
            ]
          ]
        },
        "type": "query"
      },
      "visualization_settings": {
        "graph.dimensions": [
          "name",
          "severityCategory"
        ],
        "graph.x_axis.title_text": "Application",
        "graph.y_axis.title_text": "Incidents",
        "graph.metrics": [
          "count"
        ]
      }
    },
    {
      "name": "Weekly Production Deployment Frequency (Avg)",
      "description": null,
      "display": "gauge",
      "table_id": {{ table "cicd_Deployment" }},
      "dataset_query": {
        "query": {
          "source-query": {
            "source-table": {{ table "cicd_Deployment" }},
            "filter": [
              "and",
              [
                "=",
                [
                  "field",
                  {{ field "cicd_Deployment.envCategory" }},
                  null
                ],
                "Prod"
              ],
              [
                "=",
                [
                  "field",
                  {{ field "cicd_Deployment.statusCategory" }},
                  null
                ],
                "Success"
              ]
            ],
            "aggregation": [
              [
                "count"
              ]
            ],
            "breakout": [
              [
                "field",
                {{ field "cicd_Deployment.endedAt" }},
                {
                  "temporal-unit": "week"
                }
              ]
            ]
          },
          "aggregation": [
            [
              "avg",
              [
                "field",
                "count",
                {
                  "base-type": "type/Integer"
                }
              ]
            ]
          ]
        },
        "type": "query"
      },
      "visualization_settings": {
        "gauge.segments": [
          {
            "min": 7,
            "max": 14,
            "color": "#84BB4C",
            "label": "Elite"
          },
          {
            "min": 1,
            "max": 7,
            "color": "#F9D45C",
            "label": "High"
          },
          {
            "min": 0.23,
            "max": 1,
            "color": "#F2A86F",
            "label": "Medium"
          },
          {
            "min": 0,
            "max": 0.23,
            "color": "#ED6E6E",
            "label": "Low"
          }
        ]
      }
    }
  ],
  "parameters": [
    {
      "name": "Relative Date",
      "slug": "relative_date",
      "id": "fb36dafb",
      "type": "date/relative",
      "sectionId": "date",
      "default": "past30days"
    }
  ],
  "layout": [
    {
      "row": 6,
      "col": 0,
      "sizeX": 4,
      "sizeY": 4,
      "card_id": {{ card "Average Lead Time" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "Average Lead Time" }},
          "target": [
            "dimension",
            [
              "field",
              "prod_deployed_at",
              {
                "base-type": "type/DateTimeWithLocalTZ"
              }
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 6,
      "col": 4,
      "sizeX": 8,
      "sizeY": 4,
      "card_id": {{ card "Lead Time by Application over Time" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "Lead Time by Application over Time" }},
          "target": [
            "dimension",
            [
              "field",
              "prod_deployed_at",
              {
                "base-type": "type/DateTimeWithLocalTZ"
              }
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 6,
      "col": 12,
      "sizeX": 6,
      "sizeY": 4,
      "card_id": {{ card "Lead Time Breakdown by Application" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "Lead Time Breakdown by Application" }},
          "target": [
            "dimension",
            [
              "field",
              "prod_deployed_at",
              {
                "base-type": "type/DateTimeWithLocalTZ"
              }
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 2,
      "col": 4,
      "sizeX": 8,
      "sizeY": 4,
      "card_id": {{ card "Weekly Production Deployments by Application over Time" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "Weekly Production Deployments by Application over Time" }},
          "target": [
            "dimension",
            [
              "field",
              {{ field "cicd_Deployment.endedAt" }},
              null
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 2,
      "col": 12,
      "sizeX": 6,
      "sizeY": 4,
      "card_id": {{ card "Number of Deployments by Application by Environment" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "Number of Deployments by Application by Environment" }},
          "target": [
            "dimension",
            [
              "field",
              {{ field "cicd_Deployment.endedAt" }},
              null
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 0,
      "col": 0,
      "sizeX": 18,
      "sizeY": 1,
      "card_id": null,
      "series": [],
      "parameter_mappings": [],
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "The widely used DORA metrics* are used to measure velocity and quality of software delivery. The summary below details overall performance with respect to each DORA metric (left), along with trends across applications (middle), and supporting detail (right), for context. These charts require data from deployments, commits, pull requests, and incidents in order to render completely.",
        "dashcard.background": false
      }
    },
    {
      "row": 10,
      "col": 0,
      "sizeX": 18,
      "sizeY": 1,
      "card_id": null,
      "series": [],
      "parameter_mappings": [],
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "# Quality Metrics"
      }
    },
    {
      "row": 15,
      "col": 0,
      "sizeX": 4,
      "sizeY": 4,
      "card_id": {{ card "Mean Time to Resolution (MTTR)" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "Mean Time to Resolution (MTTR)" }},
          "target": [
            "dimension",
            [
              "template-tag",
              "createdAt"
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 15,
      "col": 4,
      "sizeX": 8,
      "sizeY": 4,
      "card_id": {{ card "MTTR by Application over Time" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "MTTR by Application over Time" }},
          "target": [
            "dimension",
            [
              "template-tag",
              "createdAt"
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 15,
      "col": 12,
      "sizeX": 6,
      "sizeY": 4,
      "card_id": {{ card "MTTR by Application by Severity" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "MTTR by Application by Severity" }},
          "target": [
            "dimension",
            [
              "template-tag",
              "createdAt"
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 11,
      "col": 0,
      "sizeX": 4,
      "sizeY": 4,
      "card_id": {{ card "Change Failure Rate (CFR)" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "Change Failure Rate (CFR)" }},
          "target": [
            "dimension",
            [
              "field",
              "date",
              {
                "base-type": "type/DateTimeWithLocalTZ"
              }
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 11,
      "col": 4,
      "sizeX": 8,
      "sizeY": 4,
      "card_id": {{ card "CFR by Application over Time" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "CFR by Application over Time" }},
          "target": [
            "dimension",
            [
              "field",
              "date",
              {
                "base-type": "type/DateTimeWithLocalTZ"
              }
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 11,
      "col": 12,
      "sizeX": 6,
      "sizeY": 4,
      "card_id": {{ card "Incidents by Application by Severity" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "Incidents by Application by Severity" }},
          "target": [
            "dimension",
            [
              "field",
              {{ field "ims_Incident.createdAt" }},
              null
            ]
          ]
        }
      ],
      "visualization_settings": {}
    },
    {
      "row": 1,
      "col": 0,
      "sizeX": 18,
      "sizeY": 1,
      "card_id": null,
      "series": [],
      "parameter_mappings": [],
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "# Velocity Metrics"
      }
    },
    {
      "row": 2,
      "col": 0,
      "sizeX": 4,
      "sizeY": 4,
      "card_id": {{ card "Weekly Production Deployment Frequency (Avg)" }},
      "series": [],
      "parameter_mappings": [
        {
          "parameter_id": "fb36dafb",
          "card_id": {{ card "Weekly Production Deployment Frequency (Avg)" }},
          "target": [
            "dimension",
            [
              "field",
              "endedAt",
              {
                "base-type": "type/DateTimeWithLocalTZ"
              }
            ]
          ]
        }
      ],
      "visualization_settings": {}
    }
  ],
  "path": "/Faros CE/DORA - Deployments and Incidents",
  "priority": 3,
  "bookmark": true
}

